# shadcn/ui セットアップマニュアル

## 概要

このマニュアルでは、Next.jsプロジェクトにshadcn/uiを導入し、ダークモード機能を設定する手順を説明します。

## 前提条件

- Next.js 15.3.4以上
- Tailwind CSS v4
- TypeScript

## 1. shadcn/uiの初期化

### 1.1 初期化コマンドの実行

```bash
npx shadcn@latest init
```

### 1.2 設定オプション

- **Base color**: Slate（推奨）
- **Style**: New York
- **CSS variables**: 有効
- **Tailwind CSS**: v4（自動検出）

### 1.3 生成されるファイル

- `components.json` - shadcn/uiの設定ファイル
- `src/lib/utils.ts` - ユーティリティ関数

## 2. コンポーネントの追加

### 2.1 基本コンポーネントの追加

以下のコマンドで必要なコンポーネントを追加します：

```bash
# Dialog（モーダル）
npx shadcn@latest add dialog

# Label（ラベル）
npx shadcn@latest add label

# Radio Group（ラジオボタングループ）
npx shadcn@latest add radio-group

# Textarea（テキストエリア）
npx shadcn@latest add textarea

# Button（ボタン）
npx shadcn@latest add button

# Separator（区切り線）
npx shadcn@latest add separator
```

### 2.2 生成されるファイル

各コンポーネントは `src/components/ui/` ディレクトリに生成されます：

- `dialog.tsx`
- `label.tsx`
- `radio-group.tsx`
- `textarea.tsx`
- `button.tsx`
- `separator.tsx`

## 3. ダークモードの設定

### 3.1 next-themesのインストール

```bash
npm install next-themes
```

### 3.2 ThemeProviderコンポーネントの作成

`src/components/theme-provider.tsx` を作成：

```tsx
"use client";

import * as React from "react";
import { ThemeProvider as NextThemesProvider } from "next-themes";

export function ThemeProvider({
  children,
  ...props
}: React.ComponentProps<typeof NextThemesProvider>) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
```

### 3.3 layout.tsxの更新

`src/app/layout.tsx` を以下のように更新：

```tsx
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { ThemeProvider } from "@/components/theme-provider";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

**重要な変更点：**

- `html`タグに `suppressHydrationWarning` を追加
- `ThemeProvider` で `body` の内容を囲む
- 設定オプション：
  - `attribute="class"` - CSSクラスでテーマを制御
  - `defaultTheme="system"` - システム設定をデフォルトに
  - `enableSystem` - システム設定の検出を有効化
  - `disableTransitionOnChange` - テーマ切り替え時のトランジションを無効化

### 3.4 テーマ切り替えボタンの追加

#### 3.4.1 dropdown-menuコンポーネントの追加

```bash
npx shadcn@latest add dropdown-menu
```

#### 3.4.2 ThemeToggleコンポーネントの作成

`src/components/theme-toggle.tsx` を作成：

```tsx
"use client";

import * as React from "react";
import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

export function ThemeToggle() {
  const { setTheme } = useTheme();

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="icon">
          <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
          <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
          <span className="sr-only">テーマを切り替え</span>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem onClick={() => setTheme("light")}>
          ライト
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("dark")}>
          ダーク
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("system")}>
          システム
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

### 3.5 ページでの使用例

`src/app/page.tsx` でThemeToggleを使用：

```tsx
import Image from "next/image";
import { ThemeToggle } from "@/components/theme-toggle";

export default function Home() {
  return (
    <div className="grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]">
      {/* ThemeToggleを右上に固定 */}
      <div className="fixed top-4 right-4 z-50">
        <ThemeToggle />
      </div>

      {/* 既存のコンテンツ */}
      <main className="flex flex-col gap-[32px] row-start-2 items-center sm:items-start">
        {/* ... */}
      </main>
    </div>
  );
}
```

## 4. コンポーネントの使用方法

### 4.1 基本的なインポート

```tsx
import { Button } from "@/components/ui/button";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { Textarea } from "@/components/ui/textarea";
import { Separator } from "@/components/ui/separator";
```

### 4.2 使用例

```tsx
// ボタン
<Button variant="default">クリック</Button>

// ダイアログ
<Dialog>
  <DialogTrigger>ダイアログを開く</DialogTrigger>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>タイトル</DialogTitle>
    </DialogHeader>
    コンテンツ
  </DialogContent>
</Dialog>

// ラジオグループ
<RadioGroup defaultValue="option-one">
  <div className="flex items-center space-x-2">
    <RadioGroupItem value="option-one" id="option-one" />
    <Label htmlFor="option-one">オプション1</Label>
  </div>
</RadioGroup>
```

## 5. 設定ファイル

### 5.1 components.json

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
```

## 6. トラブルシューティング

### 6.1 よくある問題

- **Hydrationエラー**: `suppressHydrationWarning` が `html` タグに設定されているか確認
- **テーマが切り替わらない**: `ThemeProvider` が正しく設定されているか確認
- **コンポーネントが見つからない**: `@/components/ui/` のパスが正しいか確認

### 6.2 追加のコンポーネント

新しいコンポーネントを追加する場合：

```bash
npx shadcn@latest add [component-name]
```

## 7. 参考リンク

- [shadcn/ui公式ドキュメント](https://ui.shadcn.com/)
- [next-themes公式ドキュメント](https://github.com/pacocoursey/next-themes)
- [Tailwind CSS公式ドキュメント](https://tailwindcss.com/)

---

このマニュアルに従って設定することで、美しく一貫性のあるUIコンポーネントとダークモード機能を持つNext.jsアプリケーションを作成できます。
